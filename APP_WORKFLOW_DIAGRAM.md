# App Workflow & Architecture Documentation

## Current App Workflow

### 1. Installation & Authentication Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     MERCHANT JOURNEY                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 1: Discovery
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Merchant     â”‚
â”‚ finds app in â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ App Store    â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
                              â–¼
Step 2: Installation         
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Clicks "Add App" button      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
Step 3: OAuth Authorization
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Shopify OAuth Grant Screen                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ App requests access to:                â”‚  â”‚
â”‚  â”‚ â€¢ Read themes (REQUIRED)               â”‚  â”‚
â”‚  â”‚ â€¢ Write themes (REQUIRED)              â”‚  â”‚
â”‚  â”‚ âŒ â€¢ Read files (NOT NEEDED)           â”‚  â”‚
â”‚  â”‚ âŒ â€¢ Write files (NOT NEEDED)          â”‚  â”‚
â”‚  â”‚ âŒ â€¢ Read content (NOT NEEDED)         â”‚  â”‚
â”‚  â”‚ âŒ â€¢ Write content (NOT NEEDED)        â”‚  â”‚
â”‚  â”‚ âŒ â€¢ Read products (NOT NEEDED)        â”‚  â”‚
â”‚  â”‚ âŒ â€¢ Write products (NOT NEEDED)       â”‚  â”‚
â”‚  â”‚ âŒ â€¢ Read script tags (NOT NEEDED)     â”‚  â”‚
â”‚  â”‚ âŒ â€¢ Write script tags (NOT NEEDED)    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                              â”‚
â”‚  [Install app] [Cancel]                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
Step 4: App Redirect (Current - Has Issues!)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ If shop is 'okayscaledemo.myshopify.com':    â”‚
â”‚   â†’ Use hardcoded private token âŒ           â”‚
â”‚ Else:                                        â”‚
â”‚   â†’ Use OAuth token âœ…                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
Step 5: App UI Loads
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Section Store Dashboard              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ [Explore Sections] [My Sections]      â”‚  â”‚
â”‚  â”‚                                        â”‚  â”‚
â”‚  â”‚ Search: [________________] ğŸ”         â”‚  â”‚
â”‚  â”‚                                        â”‚  â”‚
â”‚  â”‚ Categories: Popular Trending Free...  â”‚  â”‚
â”‚  â”‚                                        â”‚  â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚  â”‚
â”‚  â”‚ â”‚Section â”‚ â”‚Section â”‚ â”‚Section â”‚     â”‚  â”‚
â”‚  â”‚ â”‚  #1    â”‚ â”‚  #2    â”‚ â”‚  #3    â”‚     â”‚  â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Section Installation Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  SECTION INSTALLATION                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 1: Merchant Browses Sections
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Section Card                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ [Preview Image]            â”‚   â”‚
â”‚ â”‚                            â”‚   â”‚
â”‚ â”‚ Testimonial #8             â”‚   â”‚
â”‚ â”‚ A modern testimonial       â”‚   â”‚
â”‚ â”‚ section with ratings       â”‚   â”‚
â”‚ â”‚                            â”‚   â”‚
â”‚ â”‚ Tags: testimonial, free    â”‚   â”‚
â”‚ â”‚                            â”‚   â”‚
â”‚ â”‚ [Add to Theme â–¼]           â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â”‚ (clicks "Add to Theme")
                â–¼
Step 2: Theme Selection Popover
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Select Theme:                    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ â€¢ Dawn (Live)              â”‚   â”‚
â”‚ â”‚ â€¢ Theme 2                  â”‚   â”‚
â”‚ â”‚ â€¢ Theme 3 (Draft)          â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â”‚ (selects a theme)
                â–¼
Step 3: API Request
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POST /api/sections/install                    â”‚
â”‚ {                                             â”‚
â”‚   "sectionId": "testimonial-8",               â”‚
â”‚   "shop": "merchant.myshopify.com",           â”‚
â”‚   "themeId": "123456789"                      â”‚
â”‚ }                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
Step 4: Server Processing (simple-server.js)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Validate input                             â”‚
â”‚    âœ“ sectionId exists?                        â”‚
â”‚    âœ“ shop provided?                           â”‚
â”‚    âœ“ themeId valid?                           â”‚
â”‚                                               â”‚
â”‚ 2. Get access token                           â”‚
â”‚    âŒ Check PRIVATE_APP_TOKENS (WRONG!)       â”‚
â”‚    âœ… Should: Get from session storage        â”‚
â”‚                                               â”‚
â”‚ 3. Read section file                          â”‚
â”‚    Read: ./sections/testimonial-8/section.liquid
â”‚                                               â”‚
â”‚ 4. Fetch theme (if no themeId)                â”‚
â”‚    GET /admin/api/2024-01/themes.json         â”‚
â”‚    Find active theme (role: "main")           â”‚
â”‚                                               â”‚
â”‚ 5. Install section via Shopify API            â”‚
â”‚    PUT /admin/api/2024-01/themes/{id}/assets.json
â”‚    {                                          â”‚
â”‚      "asset": {                               â”‚
â”‚        "key": "sections/testimonial-8.liquid",â”‚
â”‚        "value": "[section content]"           â”‚
â”‚      }                                        â”‚
â”‚    }                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
Step 5: Response to Merchant
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Success:                                      â”‚
â”‚ {                                             â”‚
â”‚   "success": true,                            â”‚
â”‚   "message": "Section installed!",            â”‚
â”‚   "sectionId": "testimonial-8",               â”‚
â”‚   "themeId": "123456789",                     â”‚
â”‚   "themeName": "Dawn"                         â”‚
â”‚ }                                             â”‚
â”‚                                               â”‚
â”‚ âœ… Show success toast (NOT IMPLEMENTED!)      â”‚
â”‚ âœ… Update UI (NOT IMPLEMENTED!)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. Current File Structure & Data Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        FILE STRUCTURE                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

/workspace/Shopify-theme-sections-app/
â”‚
â”œâ”€â”€ simple-server.js â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ MAIN SERVER (Express)
â”‚   â”œâ”€â”€ API Routes:
â”‚   â”‚   â”œâ”€â”€ GET  /api/themes        (List themes)
â”‚   â”‚   â”œâ”€â”€ GET  /api/sections      (List sections)
â”‚   â”‚   â”œâ”€â”€ GET  /api/my-sections   (User's sections)
â”‚   â”‚   â””â”€â”€ POST /api/sections/install (Install section)
â”‚   â”‚
â”‚   â”œâ”€â”€ Auth Routes:
â”‚   â”‚   â”œâ”€â”€ GET  /                  (Entry point)
â”‚   â”‚   â”œâ”€â”€ GET  /auth              (OAuth start)
â”‚   â”‚   â””â”€â”€ GET  /auth/callback     (OAuth callback)
â”‚   â”‚
â”‚   â””â”€â”€ Static Files:
â”‚       â””â”€â”€ /section-previews/*     (Preview images)
â”‚
â”œâ”€â”€ web/
â”‚   â”œâ”€â”€ app/                    â—„â”€â”€ REMIX APPLICATION
â”‚   â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”‚   â”œâ”€â”€ app._index.jsx      (Main UI - Section Store)
â”‚   â”‚   â”‚   â”œâ”€â”€ app.jsx             (App layout)
â”‚   â”‚   â”‚   â””â”€â”€ root.jsx            (Root layout)
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ shopify.server.js       (Shopify auth setup)
â”‚   â”‚
â”‚   â”œâ”€â”€ public/                 â—„â”€â”€ STATIC FILES
â”‚   â”‚   â”œâ”€â”€ app.html                (Main app HTML)
â”‚   â”‚   â”œâ”€â”€ install.html            (Installation page)
â”‚   â”‚   â””â”€â”€ section-previews/       (Preview images)
â”‚   â”‚
â”‚   â””â”€â”€ gdpr.js                 â—„â”€â”€ GDPR WEBHOOKS (EMPTY!)
â”‚
â”œâ”€â”€ sections/                   â—„â”€â”€ SECTION DEFINITIONS
â”‚   â”œâ”€â”€ testimonial-8/
â”‚   â”‚   â”œâ”€â”€ section.liquid          (Liquid template)
â”‚   â”‚   â”œâ”€â”€ meta.json               (Metadata)
â”‚   â”‚   â””â”€â”€ preview.png             (Preview image)
â”‚   â”‚
â”‚   â”œâ”€â”€ faq-1/
â”‚   â”‚   â””â”€â”€ section.liquid
â”‚   â”‚
â”‚   â””â”€â”€ [5 more sections...]
â”‚
â””â”€â”€ shopify.app.toml            â—„â”€â”€ APP CONFIGURATION
    â”œâ”€â”€ client_id (EXPOSED! âŒ)
    â”œâ”€â”€ scopes (TOO MANY! âŒ)
    â””â”€â”€ webhooks (Not configured properly)
```

### 4. Data Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         DATA FLOW                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Merchant   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ (1) Installs app
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Shopify OAuth Server        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Generates access token     â”‚  â”‚
â”‚  â”‚ Scopes: read/write themes  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ (2) Callback with code
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    App Server (simple-server.js) â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Exchange code for token    â”‚  â”‚
â”‚  â”‚ âŒ Store in PRIVATE_APP    â”‚  â”‚
â”‚  â”‚    TOKENS (HARDCODED!)     â”‚  â”‚
â”‚  â”‚ âœ… Should: Store in DB     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ (3) Load app UI
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Remix Frontend (React)        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Fetch sections from API    â”‚  â”‚
â”‚  â”‚ Display in grid            â”‚  â”‚
â”‚  â”‚ Handle user interactions   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ (4) Merchant clicks "Add to Theme"
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    App Server (simple-server.js) â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 1. Read section.liquid     â”‚â—„â”€â”€â”€ From filesystem
â”‚  â”‚                            â”‚  â”‚  /sections/[id]/section.liquid
â”‚  â”‚ 2. Get access token        â”‚  â”‚
â”‚  â”‚    âŒ From PRIVATE_APP_TOKENS
â”‚  â”‚    âœ… Should: From DB      â”‚  â”‚
â”‚  â”‚                            â”‚  â”‚
â”‚  â”‚ 3. Call Shopify API        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â”‚ (5) PUT /themes/{id}/assets.json
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Shopify Admin API           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Validate access token      â”‚  â”‚
â”‚  â”‚ Check theme exists         â”‚  â”‚
â”‚  â”‚ Write asset to theme       â”‚  â”‚
â”‚  â”‚ Return success/error       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ (6) Response
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Merchant                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Section now in theme!      â”‚  â”‚
â”‚  â”‚ Can use in theme editor    â”‚  â”‚
â”‚  â”‚ âŒ No confirmation shown   â”‚  â”‚
â”‚  â”‚ âŒ No tracking of install  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## What's Missing from the Workflow

### 1. No Database Layer
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         CURRENT (IN-MEMORY ONLY)             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Sessions: Lost on restart              â”‚  â”‚
â”‚  â”‚ Tokens: Hardcoded in code              â”‚  â”‚
â”‚  â”‚ Installations: Not tracked             â”‚  â”‚
â”‚  â”‚ User data: Not stored                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           NEEDED (DATABASE)                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ shops                                  â”‚  â”‚
â”‚  â”‚ â”œâ”€ shop_domain (PK)                   â”‚  â”‚
â”‚  â”‚ â”œâ”€ access_token (encrypted)           â”‚  â”‚
â”‚  â”‚ â”œâ”€ scopes                             â”‚  â”‚
â”‚  â”‚ â”œâ”€ installed_at                       â”‚  â”‚
â”‚  â”‚ â””â”€ uninstalled_at                     â”‚  â”‚
â”‚  â”‚                                        â”‚  â”‚
â”‚  â”‚ sessions                               â”‚  â”‚
â”‚  â”‚ â”œâ”€ session_id (PK)                    â”‚  â”‚
â”‚  â”‚ â”œâ”€ shop_domain (FK)                   â”‚  â”‚
â”‚  â”‚ â”œâ”€ state                              â”‚  â”‚
â”‚  â”‚ â””â”€ expires_at                         â”‚  â”‚
â”‚  â”‚                                        â”‚  â”‚
â”‚  â”‚ installations                          â”‚  â”‚
â”‚  â”‚ â”œâ”€ id (PK)                            â”‚  â”‚
â”‚  â”‚ â”œâ”€ shop_domain (FK)                   â”‚  â”‚
â”‚  â”‚ â”œâ”€ section_id                         â”‚  â”‚
â”‚  â”‚ â”œâ”€ theme_id                           â”‚  â”‚
â”‚  â”‚ â”œâ”€ installed_at                       â”‚  â”‚
â”‚  â”‚ â””â”€ removed_at                         â”‚  â”‚
â”‚  â”‚                                        â”‚  â”‚
â”‚  â”‚ sections (dynamic)                     â”‚  â”‚
â”‚  â”‚ â”œâ”€ id (PK)                            â”‚  â”‚
â”‚  â”‚ â”œâ”€ name                               â”‚  â”‚
â”‚  â”‚ â”œâ”€ description                        â”‚  â”‚
â”‚  â”‚ â”œâ”€ liquid_content                     â”‚  â”‚
â”‚  â”‚ â”œâ”€ preview_url                        â”‚  â”‚
â”‚  â”‚ â”œâ”€ tags                               â”‚  â”‚
â”‚  â”‚ â””â”€ active                             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. No Webhook Handlers
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         REQUIRED WEBHOOKS (EMPTY!)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

APP_UNINSTALLED
â”œâ”€ Trigger: Merchant uninstalls app
â”œâ”€ Current: Not handled
â””â”€ Needed: 
    â”œâ”€ Mark shop as uninstalled
    â”œâ”€ Revoke access token
    â””â”€ Schedule data deletion (48h)

CUSTOMERS_DATA_REQUEST (GDPR)
â”œâ”€ Trigger: Customer requests their data
â”œâ”€ Current: Empty callback
â””â”€ Needed:
    â”œâ”€ Query all customer data
    â”œâ”€ Format as JSON
    â””â”€ Return to Shopify

CUSTOMERS_REDACT (GDPR)
â”œâ”€ Trigger: Customer data must be deleted
â”œâ”€ Current: Empty callback
â””â”€ Needed:
    â”œâ”€ Find all customer records
    â”œâ”€ Delete from database
    â””â”€ Log deletion

SHOP_REDACT (GDPR)
â”œâ”€ Trigger: 48h after uninstall
â”œâ”€ Current: Empty callback
â””â”€ Needed:
    â”œâ”€ Delete all shop data
    â”œâ”€ Remove access tokens
    â””â”€ Log deletion
```

### 3. No Error Handling Flow
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        ERRORS NOT PROPERLY HANDLED           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

OAuth Errors:
â”œâ”€ Merchant declines permission
â”‚  â””â”€ Current: Unclear what happens
â”‚  â””â”€ Needed: Show friendly message, retry option
â”‚
â”œâ”€ Token expires
â”‚  â””â”€ Current: API calls fail silently
â”‚  â””â”€ Needed: Redirect to re-auth
â”‚
â””â”€ Invalid shop domain
   â””â”€ Current: May crash
   â””â”€ Needed: Validate and show error

API Errors:
â”œâ”€ Theme not found (404)
â”‚  â””â”€ Current: Generic error
â”‚  â””â”€ Needed: "Theme was deleted. Please select another."
â”‚
â”œâ”€ Rate limit (429)
â”‚  â””â”€ Current: Request fails
â”‚  â””â”€ Needed: Queue request, retry after delay
â”‚
â”œâ”€ Permission denied (403)
â”‚  â””â”€ Current: Generic error
â”‚  â””â”€ Needed: "App doesn't have permission. Please reinstall."
â”‚
â””â”€ Server error (500)
   â””â”€ Current: Basic error log
   â””â”€ Needed: Log to service, show user-friendly message

Section Installation Errors:
â”œâ”€ Section file not found
â”‚  â””â”€ Current: 404 error
â”‚  â””â”€ Needed: "Section not available. Please contact support."
â”‚
â”œâ”€ Invalid Liquid syntax
â”‚  â””â”€ Current: Not validated
â”‚  â””â”€ Needed: Validate before install
â”‚
â””â”€ Section already exists
   â””â”€ Current: Overwrites without warning
   â””â”€ Needed: Ask for confirmation
```

---

## Recommended Improved Workflow

### 1. Proper OAuth Flow
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              IMPROVED AUTHENTICATION FLOW                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 1: App Installation
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Merchant     â”‚
â”‚ clicks       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Shopify OAuth Screen
â”‚ "Add App"    â”‚            (Only 2 scopes!)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
Step 2: OAuth Grant
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ App requests access to:            â”‚
â”‚ âœ… â€¢ Read themes                   â”‚
â”‚ âœ… â€¢ Write themes                  â”‚
â”‚                                    â”‚
â”‚ [Install app] [Cancel]             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
Step 3: Callback Handler
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GET /auth/callback?code=abc123&shop=...â”‚
â”‚                                        â”‚
â”‚ 1. Validate request (HMAC, state)     â”‚
â”‚ 2. Exchange code for token            â”‚
â”‚ 3. Store token in DATABASE âœ…         â”‚
â”‚ 4. Register webhooks                  â”‚
â”‚ 5. Create session                     â”‚
â”‚ 6. Redirect to app UI                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
Step 4: App UI Loads
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Session validated from database        â”‚
â”‚ Access token retrieved securely        â”‚
â”‚ User sees onboarding or main UI        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Improved Installation Flow
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         IMPROVED SECTION INSTALLATION FLOW                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 1: Merchant Clicks "Add to Theme"
         â”‚
         â–¼
Step 2: Validation
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â€¢ Check if already installed           â”‚
â”‚   â””â”€ If yes: Show "Already installed.  â”‚
â”‚      Reinstall or cancel?"             â”‚
â”‚                                        â”‚
â”‚ â€¢ Validate section content             â”‚
â”‚   â””â”€ Check Liquid syntax               â”‚
â”‚   â””â”€ Check for malicious code          â”‚
â”‚                                        â”‚
â”‚ â€¢ Check theme permissions              â”‚
â”‚   â””â”€ Ensure token still valid          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
Step 3: Confirmation
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Install "Testimonial #8" to "Dawn"?    â”‚
â”‚                                        â”‚
â”‚ â„¹ï¸  This will add the section to your  â”‚
â”‚    theme. You can customize it in the â”‚
â”‚    theme editor after installation.    â”‚
â”‚                                        â”‚
â”‚ [Install] [Cancel]                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
Step 4: Installation
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”„ Installing section...               â”‚
â”‚                                        â”‚
â”‚ 1. Read section content                â”‚
â”‚ 2. Call Shopify API                    â”‚
â”‚ 3. Record in database                  â”‚
â”‚ 4. Show success message                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
Step 5: Success Feedback
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… Section installed successfully!     â”‚
â”‚                                        â”‚
â”‚ "Testimonial #8" is now available in   â”‚
â”‚ your "Dawn" theme.                     â”‚
â”‚                                        â”‚
â”‚ [View in Theme Editor]                 â”‚
â”‚ [Install Another Section]              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. Complete Webhook Handling
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   WEBHOOK PROCESSING                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

APP_UNINSTALLED Webhook
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Shopify sends webhook                  â”‚
â”‚ POST /api/webhooks                     â”‚
â”‚ {                                      â”‚
â”‚   "shop_domain": "merchant.shopify.com"â”‚
â”‚ }                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ App Handler:                           â”‚
â”‚ 1. Verify webhook signature            â”‚
â”‚ 2. Mark shop as uninstalled            â”‚
â”‚ 3. Revoke access token                 â”‚
â”‚ 4. Schedule data deletion (48h)        â”‚
â”‚ 5. Send exit survey email (optional)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CUSTOMERS_DATA_REQUEST Webhook (GDPR)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Customer requests their data           â”‚
â”‚ POST /api/webhooks                     â”‚
â”‚ {                                      â”‚
â”‚   "customer": {                        â”‚
â”‚     "id": 191167,                      â”‚
â”‚     "email": "customer@example.com"    â”‚
â”‚   }                                    â”‚
â”‚ }                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ App Handler:                           â”‚
â”‚ 1. Query all customer data             â”‚
â”‚ 2. Format as JSON                      â”‚
â”‚ 3. Return data to Shopify              â”‚
â”‚ 4. Log request                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CUSTOMERS_REDACT Webhook (GDPR)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Customer data must be deleted          â”‚
â”‚ POST /api/webhooks                     â”‚
â”‚ {                                      â”‚
â”‚   "customer": {                        â”‚
â”‚     "id": 191167                       â”‚
â”‚   }                                    â”‚
â”‚ }                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ App Handler:                           â”‚
â”‚ 1. Find all customer records           â”‚
â”‚ 2. DELETE from database                â”‚
â”‚ 3. Log deletion with timestamp         â”‚
â”‚ 4. Return 200 OK                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

SHOP_REDACT Webhook (GDPR)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 48h after uninstall, delete all data   â”‚
â”‚ POST /api/webhooks                     â”‚
â”‚ {                                      â”‚
â”‚   "shop_domain": "merchant.shopify.com"â”‚
â”‚ }                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ App Handler:                           â”‚
â”‚ 1. DELETE all shop records             â”‚
â”‚ 2. DELETE all installation records     â”‚
â”‚ 3. DELETE all session data             â”‚
â”‚ 4. Log deletion with timestamp         â”‚
â”‚ 5. Return 200 OK                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Summary

### Current Workflow Issues:
1. âŒ Mixed auth (OAuth + private tokens)
2. âŒ No database persistence
3. âŒ GDPR webhooks not implemented
4. âŒ No error handling
5. âŒ No user feedback
6. âŒ Too many API scopes
7. âŒ No validation

### Needed Improvements:
1. âœ… OAuth-only authentication
2. âœ… Database for sessions and data
3. âœ… Implement all GDPR webhooks
4. âœ… Comprehensive error handling
5. âœ… User feedback (toasts, confirmations)
6. âœ… Reduce to 2 API scopes
7. âœ… Input validation and sanitization

---

**Document Version**: 1.0
**Last Updated**: 2025-10-19
